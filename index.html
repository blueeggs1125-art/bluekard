<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUCK 1939</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            padding: 10px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
            font-size: 24px;
        }
        
        .selector-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .image-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .image-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            background-color: white;
            aspect-ratio: 2/3; 
        }
        
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .image-item .image-name {
            padding: 5px;
            font-size: 11px;
            text-align: center;
            background-color: rgba(0,0,0,0.8);
            color: white;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .no-images {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-style: italic;
            grid-column: 1 / -1;
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            grid-column: 1 / -1;
        }
        
        /* 添加导航链接样式 */
        .nav-link {
            display: block;
            text-align: center;
            margin: 15px 0;
            color: #1e90ff;
            text-decoration: none;
            font-weight: bold;
        }
        
        .nav-link:hover {
            text-decoration: underline;
        }
        
        /* 上下文菜单样式 */
        .context-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 120px;
        }
        
        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .context-menu-item:hover {
            background-color: #f0f0f0;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }
            
            .image-container {
                grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
                gap: 8px;
            }
            
            h1 {
                font-size: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .image-container {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 5px;
            }
            
            .image-item .image-name {
                font-size: 8px;
                padding: 2px;
            }
        }
    </style>
</head>
<body>
    <a href="https://space.bilibili.com/596035099" target="_blank" style="display: block; text-align: center; margin-top: 20px; color: #1e90ff; text-decoration: none;">blueeggs</a>
    <div class="container">
        <h1>KARDS素材库</h1>
        
        <!-- 添加跳转到音效页面的链接 -->
        <a href="suck.html" class="nav-link">前往音效库</a>
        <a href="zaza.html" class="nav-link">前往活字印刷术</a>
        
        <div class="selector-group">
            <label for="country-select">选择国家/类型:</label>
            <select id="country-select">
                <option value="">请选择...</option>
                <option value="苏联">苏联</option>
                <option value="美国">美国</option>
                <option value="德国">德国</option>
                <option value="日本">日本</option>
                <option value="英国">英国</option>
                <option value="波兰">波兰</option>
                <option value="法国">法国</option>
                <option value="意大利">意大利</option>
                <option value="芬兰">芬兰</option>
                <option value="总部">总部</option>
                <option value="卡背">卡背</option>
            </select>
        </div>
        
        <div class="selector-group" id="subtype-group" style="display: none;">
            <label for="subtype-select">选择卡牌类型:</label>
            <select id="subtype-select">
                <option value="">请选择...</option>
            </select>
        </div>
        
        <div id="image-display">
            <div class="no-images">请先选择国家/类型</div>
        </div>
    </div>

    <script src="js/image.js"></script>
    
    <script>
        const countries = {
            '苏联': { name: '苏联', hasSubtypes: true },
            '美国': { name: '美国', hasSubtypes: true },
            '德国': { name: '德国', hasSubtypes: true },
            '日本': { name: '日本', hasSubtypes: true },
            '英国': { name: '英国', hasSubtypes: true },
            '波兰': { name: '波兰', hasSubtypes: true },
            '法国': { name: '法国', hasSubtypes: true },
            '意大利': { name: '意大利', hasSubtypes: true },
            '芬兰': { name: '芬兰', hasSubtypes: true },
            '总部': { name: '总部', hasSubtypes: false },
            '卡背': { name: '卡背', hasSubtypes: false }
        };
        
        const subtypes = {
            '金卡': '金卡',
            '银卡': '银卡',
            '铜卡': '铜卡',
            '铁卡': '铁卡'
        };
        
        const noGoldCountries = ['波兰', '法国', '意大利', '芬兰'];
        
        const countrySelect = document.getElementById('country-select');
        const subtypeGroup = document.getElementById('subtype-group');
        const subtypeSelect = document.getElementById('subtype-select');
        const imageDisplay = document.getElementById('image-display');
        
        countrySelect.addEventListener('change', function() {
            const country = this.value;
            if (!country) {
                subtypeGroup.style.display = 'none';
                imageDisplay.innerHTML = '<div class="no-images">请先选择国家/类型</div>';
                return;
            }
            
            const countryConfig = countries[country];
            if (countryConfig.hasSubtypes) {
                subtypeGroup.style.display = 'block';
                updateSubtypeOptions(country);
                imageDisplay.innerHTML = '<div class="no-images">请选择卡牌类型</div>';
            } else {
                subtypeGroup.style.display = 'none';
                displayImages(country);
            }
        });
        
        subtypeSelect.addEventListener('change', function() {
            const country = countrySelect.value;
            const subtype = this.value;
            if (country && subtype) {
                displayImages(country, subtype);
            } else {
                imageDisplay.innerHTML = '<div class="no-images">请选择卡牌类型</div>';
            }
        });
        
        function updateSubtypeOptions(country) {
            subtypeSelect.innerHTML = '<option value="">请选择...</option>';
            
            for (const [key, name] of Object.entries(subtypes)) {
                if (key === '金卡' && noGoldCountries.includes(country)) {
                    continue;
                }
                const option = document.createElement('option');
                option.value = key;
                option.textContent = name;
                subtypeSelect.appendChild(option);
            }
        }
        
        async function displayImages(country, subtype = null) {
            imageDisplay.innerHTML = '<div class="loading">加载中...</div>';
            
            try {
                const images = await getImagesForCountry(country, subtype);
                
                if (images.length === 0) {
                    imageDisplay.innerHTML = '<div class="no-images">该分类下暂无图片</div>';
                    return;
                }
                
                const pngImages = images.filter(image => 
                    image.toLowerCase().endsWith('.png')
                );
                
                if (pngImages.length === 0) {
                    imageDisplay.innerHTML = '<div class="no-images">该分类下暂无PNG图片</div>';
                    return;
                }
                
                let html = '<div class="image-container">';
                pngImages.forEach(image => {
                    const fileName = image.split('/').pop();
                    html += `
                        <div class="image-item">
                            <img src="${image}" alt="${fileName}" 
                                 oncontextmenu="showContextMenu(event, '${image}', '${fileName}')"
                                 ontouchstart="handleTouchStart(event, '${image}', '${fileName}')"
                                 ontouchend="handleTouchEnd()"
                                 ontouchmove="handleTouchMove()">
                            <div class="image-name">${fileName}</div>
                        </div>
                    `;
                });
                html += '</div>';
                
                imageDisplay.innerHTML = html;
                
            } catch (error) {
                console.error('加载图片出错:', error);
                imageDisplay.innerHTML = '<div class="no-images">加载图片失败</div>';
            }
        }
        
        // 上下文菜单相关变量
        let contextMenu = null;
        let touchStartTime;
        let touchTimer;
        
        // 显示上下文菜单
        function showContextMenu(event, url, filename) {
            event.preventDefault();
            
            // 如果已有菜单，先移除
            if (contextMenu) {
                document.body.removeChild(contextMenu);
                contextMenu = null;
            }
            
            // 创建新菜单
            contextMenu = document.createElement('div');
            contextMenu.className = 'context-menu';
            contextMenu.style.left = event.pageX + 'px';
            contextMenu.style.top = event.pageY + 'px';
            
            // 下载选项
            const downloadItem = document.createElement('div');
            downloadItem.className = 'context-menu-item';
            downloadItem.textContent = '下载';
            downloadItem.onclick = () => {
                downloadImage(event, url, filename);
                document.body.removeChild(contextMenu);
                contextMenu = null;
            };
            
            // 导入制作库选项
            const importItem = document.createElement('div');
            importItem.className = 'context-menu-item';
            importItem.textContent = '导入制作库';
            importItem.onclick = () => {
                importToCreationLibrary(url, filename);
                document.body.removeChild(contextMenu);
                contextMenu = null;
            };
            
            contextMenu.appendChild(downloadItem);
            contextMenu.appendChild(importItem);
            document.body.appendChild(contextMenu);
            
            // 点击其他地方关闭菜单
            const closeMenu = (e) => {
                if (contextMenu && !contextMenu.contains(e.target)) {
                    document.body.removeChild(contextMenu);
                    contextMenu = null;
                    document.removeEventListener('click', closeMenu);
                }
            };
            setTimeout(() => document.addEventListener('click', closeMenu), 10);
        }
        
        // 触摸事件处理
        function handleTouchStart(event, url, filename) {
            touchStartTime = Date.now();
            clearTimeout(touchTimer);
            
            touchTimer = setTimeout(() => {
                if (Date.now() - touchStartTime >= 1000) {
                    showContextMenu(event, url, filename);
                }
            }, 1000);
        }
        
        function handleTouchEnd() {
            clearTimeout(touchTimer);
        }
        
        function handleTouchMove() {
            clearTimeout(touchTimer);
        }
        
        // 下载图片
        function downloadImage(event, url, filename) {
            event.preventDefault();
            
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // 导入制作库
        function importToCreationLibrary(url, filename) {
            // 从localStorage获取现有制作库数据
            let creationLibrary = JSON.parse(localStorage.getItem('creationLibrary') || '[]');
            
            // 检查是否已存在
            const exists = creationLibrary.some(item => item.url === url);
            if (exists) {
                alert('该图片已存在于制作库中');
                return;
            }
            
            // 添加到制作库
            creationLibrary.push({
                url: url,
                filename: filename,
                addedAt: new Date().toISOString()
            });
            
            // 保存到localStorage
            localStorage.setItem('creationLibrary', JSON.stringify(creationLibrary));
            alert('已导入制作库');
        }
        
        // 页面点击关闭菜单
        document.addEventListener('click', function(e) {
            if (contextMenu && !contextMenu.contains(e.target)) {
                document.body.removeChild(contextMenu);
                contextMenu = null;
            }
        });
    </script>
</body>
</html>